---
title: "Disaster Relief Simulation"
author: "Daniel Dittenhafer & Jashan Narhan"
date: "April 26, 2016"
documentclass: article 
geometry: margin=0.75in
output: 
  pdf_document:
    number_sections: yes
subtitle: "DATA 604: Simulation & Modeling"
---
```{r rmd-init, echo=FALSE, code=readLines("../RmdInit.R"), results='hide',message=FALSE}
# Initialize our Rmd environment
```

```{r, echo=FALSE, message=FALSE}
library(knitr)
library(knitcitations)
library(RefManageR)

cleanbib()

cite_options(style="markdown")

# bibBirthData <- bibentry(bibtype="Misc",
#                          author=person(family="HHS"),
#                          publisher="United States Department of Health and Human Services (US DHHS), Centers for Disease Control and Prevention (CDC), National Center for Health Statistics (NCHS), Division of Vital Statistics",
#                          title="Natality public-use data 2007-2014 on CDC WONDER Online Database",
#                          year=2016,
#                          month="February",
#                          url="http://wonder.cdc.gov/natality-current.html")


bibBastianEtAl <- bibentry(bibtype="Article",
                 title="Multi-criteria logistics modeling for military humanitarian assistance and disaster relief aerial delivery operations",
                 author=personList(person(family="Bastian", given="Nathaniel"),
                                   person(family="Griffin", given="Paul"),
                                   person(family="Spero", given="Eric"),
                                   person(family="Fulton", given="Lawrence")),
                 publisher="Springer Berlin Heidelberg",
                 journal="Optimization Letters",
                 year=2015,
                 doi="10.1007/s11590-015-0888-1")

bibOzdamarEtAl <- bibentry(bibtype="Article",
                 title="Emergency Logistics Planning in Natural Disasters",
                 author=personList(person(family="Ozdamar", given="Linet"),
                                   person(family="Ekinci", given="Ediz"),
                                   person(family="Kucukyazici", given="Beste")),
                 publisher="Kluwer Academic Publishers",
                 journal="Annals of Operations Research",
                 year=2004,
                 doi="10.1023/B:ANOR.0000030690.27939.39")

bibKungEtAl <- bibentry(bibtype="Article",
                 title="Designing intelligent disaster prediction models and systems for debris-flow in Taiwan",
                 author=personList(person(family="Kung", given="Hsu-Yang"),
                                   person(family="Chen", given="Chi-Hua"),
                                   person(family="Ku", given="Hao-Hsiang")),
                 publisher="Elsevier",
                 journal="Expert Systems with Applications",
                 year=2012, 
                 doi="10.1016/j.eswa.2011.11.083")


bibRottEtAl <- bibentry(bibtype="Article",
                 title="A transshipment model for distribution and inventory relocation under
                 uncertainty in humanitarian operations",
                 author=personList(person(family="Rottkemper", given="Beate"),
                                   person(family="Fisher", given="Kathrin"),
                                   person(family="Blecken", given="Alexander")),
                 publisher="Elsevier",
                 journal="Socio-Economic Planning Sciences",
                 year=2012,
                 doi="10.1016/j.seps.2011.09.003")

bibHdxWeb <- bibentry(bibtype="Misc",
                      author=person(family="United Nations Secretariat"),
                      title="Humanitarian Data Exchange",
                      publisher="United Nations Office for the Coordination of Humanitarian Affairs",
                      year=2016,
                      url="https://data.hdx.rwlabs.org/")

bibCREDWeb <- bibentry(bibtype="Misc",
                      author=person(family="EM-Dat"),
                      title="International Disaster Database",
                      publisher="Centre for Research on the Epidemiology of Disasters",
                      year=2016,
                      url="http://www.emdat.be/advanced_search/index.html")

  
```

```{r helper-funcs, echo=FALSE}
reliefBenAvgForScenarios <- function(scenarios)
{
  dfExp <- subset(dfResults, Object.Name == "ReliefBeneficiary" & 
                            Scenario %in% scenarios &
                            Data.Item == "TimeInSystem" &
                            Statistic.Type == "Average (Hours)")  
  return(dfExp)
}
```

# Abstract

# Keywords

# Literature Review

The number of disasters witnessed over time appear to be increasing in terms of 
frequency and impact. Figure 1 for example, depicts the average number of people
killed or adversely impacted (i.e. made homeless, injured or economically 
affected) due to natural disasters from the year 1900 to date. This information 
is based on disaster data pertaining to *notable* events in each year 
`r citep(bibCREDWeb)`.

\begin{center}
\includegraphics{../images/Report_Fig1.png}
\end{center}
\begin{center}
\text{Fig 1: Averaged number of people killed or affected by disasters by year}
\end{center}

While there are fluctuations from year to year, there is a clear trend showing a
growth in the numbers or people who are affected or killed by disasters over 
time. 

Responding to these types of disasters is a highly complex process. Often 
multiple stakeholders will be engaged, working under stressful environments with
severe time pressure and significant uncertainty with respect to whether they 
can work to save lives. In this context, we are beginning to see an increase in 
the amount of research into models and systems that can potentially help 
humanitarian workers make informed decisions. For example Kung et al 
`r citep(bibKungEtAl)` present three prediction models and an inference engine 
using linear regression, multivariate analysis and back propagation networks to 
assess potential debris flows resulting from earthquakes. In another example, 
Rottkemper et al `r citep(bibRottEtAl)` present a mixed-integer programming 
model for an integrated relocation and distribution planning solution designed 
to  minimize both operational costs and unmet demand for relief items.

Within the logistics aspects of emergency management, Ozdamar et al 
`r citep(bibOzdamarEtAl)` present a model to complement decision support systems
related to logistics planning following a disaster. The study contrasts various 
algorithmic approaches to solving for multi-period, multi-commodity network flow
problems coupled with a vehicle routing problem.

Ozdamar et al's study helps to designate routing decisions for vehicles. The 
authors also note that the resolution to the various optimization choices are 
NP-hard. They suggest heuristic methodologies be applied to find solutions to 
large scale problems. Building on this recommendation, the current study, aims 
to understand the dynamics of in-country humanitarian logistics via simulations.
In running the simulation, we aim to design a model of a simplified humanitarian 
logistics chain for the purpose of understnding the behaviour of the system and 
for evaluation certain strategies.

We aim to model aspects of the humanitarian logistics chain using computer 
simulation software (Simio). The intent is to understand the realities of moving
humanitarian aid, particularly to the last mile of distributions (something that
has not garnered as much research in the literature). 

# Methodology

## Structure

The basic objective of a logistics system is to deliver the appropriate 
supplies, in good condition, in the quantities required, and at the places and 
time they are needed. Some emergencies generate a limited need for very rapid 
and very specific deliveries of supplies, commodities and resources from outside
the affected area. This process entails the implementation of the international 
humanitarian logistics chain (IHLC) as depicted in the following chart.

\begin{center}
\includegraphics{../images/International Humanitarian Log Chain.jpeg}
\end{center}
\begin{center}
\text{Fig 2: The International Humanitarian Logistics Chain}
\end{center}

The IHLC is an involved process adding much complexity to the movement of relief 
resources. It is also important to note that the bulk of relief logistic 
operations never receive international attention. In an effort to simplify the 
modelling of the logistic chain, and in keeping with the latter fact, this 
project will consider the simulation needs of a in-country based logistic chain.
The simplification of the model is shown in Figure 3.

\begin{center}
\includegraphics{../images/Simplified_HLC.jpeg}
\end{center}
\begin{center}
\text{Fig 3: The Simplified Humanitarian Logistics Chain}
\end{center}

Key entities are readily recognized from Figure 3. A short description follows on
each entity that is modelled.

### Supplier

A Supplier entity is included in the simulation model. This entity is the source of ReliefSupplies. This entity is used, through design of experiments, to simulate both reliable partner suppliers as well as ad hoc suppliers (more variability in their supply). The following variables (Referenced Properties) were created to facilitate the study: 

* The time to deliver a shipment of supplies:  *SupplierTravelTimeToWarehouse*. 

* The maximum number of relief supplies which the supplier will provide: *SupplierMaximumArrivals* 

The delivery vehicle, PartnerVehicle, was set to require a full load prior to departing for the Warehouse.

* The capacity of the PartnerVehicle: *SupplierVehicleCapacity*

### Warehouse

A Warehouse was added to store disaster relief supplies in preparation for a disaster. This entity was modelled as a server which processes incoming ReliefSupplies and stores them in a ready state for movement to a DistributionSite.

The following variables were created to facilitate design of experiments:

* The storage capacity of the warehouse: *WarehouseStorageCapacity*

The delivery vehicle, WarehouseVehicle, was set to require a full load prior to departing for a distribution site and have periodic failures.

* The capacity of the WarehouseVehicle: *WarehouseVehicleCapacity*

* The frequency of failure: *WarehouseVehicleUptimeBetweenFailures*

The selection weight on the paths from the Warehouse to the Distribution Sites were set to dynamically adjust based on the number of Relief Beneficiaries  waiting for Relief Supplies.

### Distribution Sites

Two distribution sites are included in the simulation and are modelled as combiners which match Relief Supplies to Relief Beneficiaries.

The following variables were created to facilitate design of experiments:

* The processing time needed to provide a ReliefSupply item to a ReliefBeneficiary: DistSiteProcessingTime

### Relief Beneficiaries

The Relief Beneficiaries represent entities who are affected by the disaster and require ReliefSupplies. Two separate sources were included in the model to simulate separate points from which beneficiaries would origination for each distribution site.

The following variables were created to facilitate design of experiments:

* The interarrival time of the ReliefBeneficiaries: *ReliefBeneficiaryInterarrivalTime*

* The maximum number of ReliefBeneficiaries from a given source: *DisasterVictimMaximumArrivals*

### Disaster

The "Disaster" is set to begin at a designated time into the simulation. This gives some time to prestage relief supplies through the warehouse (priming the pump).

The following variables were created to facilitate design of experiments:

* The amount of time between simulation start and onset of the disaster: *DisasterTimeOffset*


## Measured Outcomes

### Average Beneficiary Time in System

Measured in hours, this response is an important indicator of the performance of the system.

### Relief Supplies Distributed

How many relief supplies were distributed?

### Unsatisfied Beneficiaries

Naturally, we wanted this response to be zero (0) throughout all simulations.

### Maximum Distribution Site 1 Time Waiting

Measured in hours, this response helped us understand the degree of the worst case scenario for distribution site 1 beneficiaries in need of relief supplies.

### Maximum Distribution Site 2 Time Waiting

Measured in hours, this response helped us understand the degree of the worst case scenario for distribution site 2 beneficiaries in need of relief supplies.

## Design of Experiments

### Supplier: Partner vs Ad Hoc

How does a dedicated supplier whose production time is lower (more units of production are committed to our orders), versus an ad hoc supplier whose production time is longer, affect the measured outcomes.

### Control Variables

The following table shows key parameters (control variables) for each scenario:

```{r, echo=FALSE}
dfControls <- data.frame(
  Name=c("Partner Supplier", 
         "Adhoc Supplier", 
         "Midlevel Supplier", 
         "Midlevel Access to Dist Site 1", 
         "Quick Access to Dist Site 1"),
  ReliefSuppliesInterarrivalTime=c("Random.Normal(1, 0.1)",
                                   "Random.Normal(4, 0.1)",
                                   "Random.Normal(2.5, 0.1)",
                                   "Random.Normal(1, 0.1)",
                                   "Random.Normal(1, 0.1)"),  WarehouseTravelTimeToDistSite1=c("Random.Normal(6,0.5)",
                                   "Random.Normal(6,0.5)",
                                   "Random.Normal(6,0.5)",
                                   "Random.Normal(4,0.5)",
                                   "Random.Normal(2,0.5)")

)
kable(dfControls)
```

# Results

```{r, echo=FALSE}
# Load the results from the Simio CSV
dfResults <- read.table("../project/DisasterReliefSim-Simio_DisasterReliefModel_SupplierExperiment_ResultsSummary.csv",
                        sep=",", header=TRUE, stringsAsFactors=FALSE)

#summary(dfResults)

# Add on our Control Variable values (haven't found how to export these from Simio yet)
dfResults$SupplierReliefSuppliesInterarrivalTimeMean <- NA
dfResults[dfResults$Scenario == "Partner Supplier", ]$SupplierReliefSuppliesInterarrivalTimeMean <- 1
dfResults[dfResults$Scenario == "Midlevel Supplier", ]$SupplierReliefSuppliesInterarrivalTimeMean <- 2.5
dfResults[dfResults$Scenario == "Adhoc Supplier", ]$SupplierReliefSuppliesInterarrivalTimeMean <- 4

dfResults$WarehouseTravelTimeToDistributionSite1 <- NA
dfResults[dfResults$Scenario == "Partner Supplier", ]$WarehouseTravelTimeToDistributionSite1 <- 6
dfResults[dfResults$Scenario == "Midlevel Access to Dist Site 1", ]$WarehouseTravelTimeToDistributionSite1 <- 4
dfResults[dfResults$Scenario == "Quick Access to Dist Site 1", ]$WarehouseTravelTimeToDistributionSite1 <- 2
```

## Supplier Production Committment

```{r, echo=FALSE, fig.height=3}
# Select only the scenarios that are related to this experiment
vSupplierScenarios <- c("Partner Supplier", "Adhoc Supplier", "Midlevel Supplier")
dfExp <- reliefBenAvgForScenarios(vSupplierScenarios)

g1 <- ggplot(dfExp) + 
  geom_line(aes(x=SupplierReliefSuppliesInterarrivalTimeMean, y=Average)) +
  labs(x="Supplier Relief Supplies Interarrival Time Mean (minutes)",
       y="Avg Beneficiary Time In System (hours)") +
  myTheme
g1
```

## Warehouse Access to Distribution Site

```{r, echo=FALSE, fig.height=3}
vScenarios <- c("Partner Supplier", 
                "Midlevel Access to Dist Site 1", 
                "Quick Access to Dist Site 1")

# Select only the scenarios that are related to this experiment
dfExp <- reliefBenAvgForScenarios(vScenarios)

#dfExp
g2 <- ggplot(dfExp) + 
  geom_line(aes(x=WarehouseTravelTimeToDistributionSite1, y=Average)) +
  labs(x="Supplier Relief Supplies Interarrival Time Mean (minutes)",
       y="Avg Beneficiary Time In System (hours)") +
  myTheme
g2
```


Suggestions for future work

# Summary

# References

```{r, results='asis', echo=FALSE}
BibOptions(style="html", bib.style="authortitle")
bibliography()
```

# Appendix: Raw Code

